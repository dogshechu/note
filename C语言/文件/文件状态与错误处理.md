### 1. 状态检测函数

#### feof() - 检测文件结束

c

`int feof(FILE *stream);`

- 只能检测是否已发生文件结束
    
- **常见误区**：不应该在读取前检查feof()
    

#### ferror() - 检测文件错误

c

`int ferror(FILE *stream);`

- 检测是否发生读写错误
    

#### clearerr() - 清除错误标志

c

`void clearerr(FILE *stream);`

- 清除文件结束和错误标志
    

### 2. perror() - 输出错误信息

c

`void perror(const char *s);`

- 输出自定义字符串和系统错误信息
    

**正确的错误处理模式：**

```c

#include <stdio.h>
#include <stdlib.h>

void process_file(const char *filename) {
    FILE *fp = fopen(filename, "r");
    if (fp == NULL) {
        perror("打开文件失败");
        exit(EXIT_FAILURE);
    }
    
    int value;
    int sum = 0;
    int count = 0;
    
    // 正确的读取循环
    while (fscanf(fp, "%d", &value) == 1) {
        sum += value;
        count++;
    }
    
    // 检查结束原因
    if (feof(fp)) {
        printf("读取完成，共读取 %d 个数字，总和：%d\n", count, sum);
    } else if (ferror(fp)) {
        perror("读取过程中发生错误");
        clearerr(fp);  // 清除错误标志
    }
    
    fclose(fp);
}
```